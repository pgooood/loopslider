/**
 * LoopSlider
 * @version 0.1
 * @author Pavel Khoroshkov aka pgood
 * @link https://github.com/pgooood/loopslider
 */
(function(a){a.fn.loopslider=function(r){r=a.extend({htmlSliderWraper:'<div class="loopslider"></div>',htmlSliderBody:'<div style="position:relative;"></div>',htmlItemWraper:'<div style="display:inline-block;"></div>',htmlPaginationContainer:'<div class="loopslider-pagination"></div>',htmlPaginationItem:"<div></div>",visibleItems:3,slideDuration:400,easing:"swing",responsive:false,touchSupport:true,autoplay:false,stopOnHover:false,autoplayInterval:3000,prevButton:null,nextButton:null,stopButton:null,playButton:null,gap:0,step:1,pagination:false,navigation:false,onStop:null,onPlay:null,onMove:null},r);r.gap=parseInt(r.gap);r.gap=!isNaN(r.gap)&&r.gap>0?r.gap:0;r.visibleItems=r.visibleItems>0?parseInt(r.visibleItems):1;r.step=parseInt(r.step);r.step=isNaN(r.step)||r.step<1?1:(r.step>r.visibleItems?r.visibleItems:r.step);var m=[],i;function c(t){var s={$e:a(r.htmlSliderBody).appendTo(a(r.htmlSliderWraper).width("100%")).width("1000%"),$items:function(){return this.$e.find(">*")},$currentItem:function(){return this.$e.find(">*:first-child")},currentIndex:function(){return this.$currentItem().data("index")}};t.find(">*").each(function(u){a(r.htmlItemWraper).append(this).appendTo(s.$e).data("index",u)});t.append(s.$e.parent());s.length=s.$items().length;return s}function p(t){var s=t.$e.parent().width();t.itemWidth=(s-r.gap*(r.visibleItems-1))/r.visibleItems;if(t.arInvisible&&t.arInvisible.length){t.$e.append(t.arInvisible)}t.arInvisible=[];var u=t.$items();u.css({"margin-right":((r.gap>0?r.gap*100/s:0)/10).toFixed(3)+"%",width:((t.itemWidth*100/s)/10).toFixed(3)+"%"});if(t.enabled=t.length>r.visibleItems){u.each(function(v,w){if(v>=r.visibleItems){t.arInvisible.push(w)}});a(t.arInvisible).detach()}return t}function o(){a(m).each(function(){var v=this,s=Math.ceil(v.length/r.visibleItems),t=a(r.htmlPaginationContainer);if(v.$pagination){v.$pagination.parent().remove()}if(!v.enabled){return true}for(var u=0;u<s;u++){a(r.htmlPaginationItem).appendTo(t).addClass("loopslider-page-nav-item").click(function(w){return function(){n(w*r.visibleItems)}}(u))}t.insertAfter(v.$e.parent());v.$pagination=t.find(">.loopslider-page-nav-item");f(v)})}function q(t,u){if(!a("#loopslider-sprite").length){a("body").get(0).insertAdjacentHTML("afterbegin",'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="loopslider-sprite" style="display:none"><symbol id="loopslider-prev-icon" viewBox="0 0 50 50"><path d="M27.3 34.7L17.6 25l9.7-9.7 1.4 1.4-8.3 8.3 8.3 8.3z"/></symbol><symbol id="loopslider-next-icon" viewBox="0 0 50 50"><path d="M22.7 34.7l-1.4-1.4 8.3-8.3-8.3-8.3 1.4-1.4 9.7 9.7z"/></symbol></svg>')}var s=a('<div class="loopslider-nav-button loopslider-'+t+'-button"></div>');s.appendTo(u).get(0).insertAdjacentHTML("afterbegin",'<svg><use xlink:href="#loopslider-'+t+'-icon"/></svg>');return s}function d(){a(m).each(function(){var t=this,s=function(){var u=t.$e.parent().height()/2;t.prevButton.css("top",u-t.prevButton.height()/2);t.nextButton.css("top",u-t.nextButton.height()/2)};if(!t.prevButton){t.prevButton=q("prev",t.$e.parent()).click(function(){h()})}if(!this.nextButton){this.nextButton=q("next",t.$e.parent()).click(function(){j()})}s();t.$e.find("img").load(s)})}function f(s){if(s.$pagination){s.$pagination.removeClass("loopslider-active");s.$pagination.eq(Math.round(s.currentIndex()/r.visibleItems)).addClass("loopslider-active")}}function h(s){s=s||r.step;a(m).each(function(){var u=this,v;if(u.enabled&&!u.motion){l();u.motion=true;for(var t=0;t<s;t++){a(u.arInvisible.pop()).prependTo(u.$e)}u.$e.css("left",((u.itemWidth+r.gap)*-s));u.$e.animate({left:0},r.slideDuration,r.easing,function(){for(var w=0;w<s;w++){v=u.$items();u.arInvisible.unshift(v.get(v.length-1));v.eq(v.length-1).detach()}u.motion=false;f(u);if(i){g()}if(typeof(r.onMove)==="function"){r.onMove(u.currentIndex(),u.$currentItem().find(">*:first-child"),"backward")}})}});return false}function j(s){s=s||r.step;a(m).each(function(){var u=this,v;if(u.enabled&&!u.motion){l();u.motion=true;for(var t=0;t<s;t++){a(u.arInvisible.shift()).appendTo(u.$e)}u.$e.animate({left:((u.itemWidth+r.gap)*-s)},r.slideDuration,r.easing,function(){for(var w=0;w<s;w++){v=u.$items();u.arInvisible.push(v.get(0));v.eq(0).detach()}u.$e.css("left",0);u.motion=false;f(u);if(i){g()}if(typeof(r.onMove)==="function"){r.onMove(u.currentIndex(),u.$currentItem().find(">*:first-child"),"forward")}})}});return false}function n(s){s=parseInt(s);if(isNaN(s)){return}a(m).each(function(){var t=this,x=t.$currentItem().data("index"),w=s-x,v=t.length-x+s,u=t.length-s+x;if(s>=t.length||s==x){return true}if(Math.abs(w)<v&&Math.abs(w)<u){if(w>0){j(w)}else{h(Math.abs(w))}}else{if(v<u){j(v)}else{h(u)}}})}function g(){l();a(m).each(function(){var s=this;if(s.enabled&&r.autoplayInterval>r.slideDuration){s.autoplayIntervalId=window.setInterval(function(){j()},r.autoplayInterval)}})}function l(){a(m).each(function(){var s=this;if(s.autoplayIntervalId){window.clearInterval(s.autoplayIntervalId);s.autoplayIntervalId=null}})}function e(){g();i=true;if(typeof(r.onPlay)==="function"){r.onPlay()}}function k(){a(m).each(function(){var x=this.$e.get(0),u,t,s=100,v=1000,w;if(!x.addEventListener){return}x.addEventListener("touchstart",function(y){var z=y.changedTouches[0];u=z.pageX;t=z.pageY;w=new Date().getTime()},false);x.addEventListener("touchend",function(z){var B=z.changedTouches[0],y=new Date().getTime()-w,A=Math.abs(B.pageX-u);if(v>=y&&A>=s&&A>=Math.abs(B.pageY-t)){B.pageX-u>0?h():j()}},false)})}function b(){l();a(m).each(function(){this.$e.stop(true,true)});if(r.responsive){var t=parseInt(a(window).width()),u=Number.MAX_SAFE_INTEGER;for(var s in r.responsive){if(parseInt(s)>=t&&parseInt(s)<parseInt(u)){u=s}}if(r.responsive[u]){a.extend(r,r.responsive[u])}}a(m).each(function(){p(this)});if(r.navigation){d()}if(r.pagination){o()}if(i){g()}}a(this).each(function(){m.push(c(a(this)))});b();a(window).resize(b);a(r.nextButton).click(function(){j();return false});a(r.prevButton).click(function(){h();return false});a(r.playButton).click(function(){e();return false});a(r.stopButton).click(function(){l();i=false;if(typeof(r.onStop())==="function"){r.onStop()}return false});if(r.touchSupport){k()}if(r.autoplay){e()}if(r.stopOnHover){a(this).mouseenter(function(){if(i){l()}});a(this).mouseleave(function(){if(i){g()}})}}}(jQuery));